# CPMS 角色与部署说明（离线内网版）

## 1. 适用范围
- 本文仅适用于 `CPMS`（公民护照管理系统）。
- `CPMS` 与 `CIIC` 是两套不同软件，边界独立。
- `CPMS` 不连接互联网，仅在局域网内运行。

## 2. 部署模型
- 1 台内网主机（Server 主机）：
  - 存放 CPMS 主数据（数据库、照片、指纹、附件、审计日志）。
  - 默认由超级管理员维护。
- N 台客户端电脑（例如 20 台）：
  - 安装 CPMS 客户端。
  - 通过局域网访问主机上的同一份数据。
- 结果：所有客户端看到的是同一套实时数据，不是各自独立副本。

## 3. 登录与权限边界
- 操作系统账号（Windows/macOS/Linux 本机用户）：
  - 仅用于开机和进入本机桌面环境。
  - 不代表 CPMS 业务权限。
- CPMS 系统账号（业务账号）：
  - 用于登录 CPMS。
  - 决定可执行的业务操作范围。
- 结论：管理员应登录 CPMS 账号，而不是依赖操作系统账号做业务授权。

## 4. 角色模型
- 超级管理员（Super Admin）：
  - 首次安装初始化创建（默认仅 1 个）。
  - 创建/禁用/重置系统管理员。
  - 分配角色与权限策略。
  - 查看全量审计日志与系统配置。
- 系统管理员（Admin）：
  - 登录 CPMS 执行档案录入、查询、修改等授权操作。
  - 无权管理超级管理员账户。

## 5. 首次安装流程
1. 在内网主机安装 CPMS 主程序并初始化数据目录。
2. 系统创建超级管理员初始账户。
3. 首次登录后强制修改初始密码。
4. 超级管理员创建普通系统管理员账户。
5. 客户端电脑安装 CPMS 并配置主机地址后登录使用。

## 6. 档案索引号规则
- 规则：`省代码 + 性别码 + 生日码 + 档案编号`
- 省代码：两位大写字母（`[A-Z]{2}`）
- 性别码：男 `M`，女 `W`
- 生日码：`YYYYMMDD`
- 档案编号：建议 6 位数字流水号
- 推荐正则：`^[A-Z]{2}(M|W)[0-9]{8}[0-9]{6}$`

## 7. 备份与跨机恢复
- 备份目标：备份文件可拷贝到另一台电脑后直接恢复可用。
- 备份包应包含：
  - 数据库文件
  - 照片/指纹/附件文件
  - 配置与密钥元数据
  - 版本清单（manifest）
- 恢复流程：
1. 在目标电脑安装同版本 CPMS。
2. 导入备份包。
3. 使用超级管理员账号登录并校验数据完整性。

## 8. 运行原则
- 禁止把同一个 SQLite 文件放在共享盘上被多机直接并发读写。
- 多机并发必须通过“主机集中存储 + 客户端访问”的方式实现。
- 所有关键操作必须记录审计日志（登录、增删改、导入导出、权限变更）。
