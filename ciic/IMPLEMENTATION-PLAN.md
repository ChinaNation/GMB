# CIIC 实施计划（不改链版本）

## 1. 目标
- 基于既定技术栈 `Tauri + React + TypeScript + Vite` 完成 CIIC 独立系统上线。
- 完成“人工绑定 + 自动投票凭证”闭环。
- 全程不修改区块链业务代码，仅做接口对接。

## 2. 范围
- 在范围内：
  - 管理员桌面端
  - CIIC API 服务
  - Signer 签名服务
  - PostgreSQL 数据库与审计
- 不在范围内：
  - 公民档案管理系统内部功能
  - 区块链 Runtime 与 Pallet 代码改造

## 3. 里程碑计划（建议 6 周）

### M1（第 1-2 周）：人工绑定闭环
交付目标：
- 可创建绑定申请
- 管理员可手工确认绑定
- 可签发绑定凭证

任务清单：
1. 建库与基础表落地（`bind_requests`、`archive_bindings`、`audit_logs`）
2. 管理员登录、角色控制、2FA 骨架
3. `bind/request`、`admin/bind/confirm`、`bind/credential` API
4. 桌面端：工单列表、详情、手工录入绑定页面
5. 审计日志入库与查询

验收标准：
- 管理员可完成一次完整人工绑定流程
- 唯一约束生效（索引号唯一、公钥唯一）
- 每次人工操作有审计记录

### M2（第 3-4 周）：自动投票凭证闭环
交付目标：
- 已绑定账户可自动获取投票凭证
- 投票凭证支持短时效与一次性 nonce

任务清单：
1. `vote/credential` API
2. `credential_issues` 表与签发流水
3. signer 服务对接（Bind/Vote 两种载荷）
4. 限流、防刷、失败重试策略
5. 对接联调（轻节点侧接口验证）

验收标准：
- 绑定有效账户可自动拿到投票凭证
- 未绑定或失效账户被拒绝
- nonce/时效规则生效并可追溯

### M3（第 5-6 周）：安全与运维增强
交付目标：
- 达到上线可用安全基线
- 形成可观测与运维闭环

任务清单：
1. 双人复核（可配置）
2. 密钥轮换（`key_id` 生效窗口）
3. 告警与监控（失败率、异常频次、签名延迟）
4. 备份与恢复演练（数据库与审计日志）
5. 上线文档、回滚预案、值班手册

验收标准：
- 2FA 与权限生效
- 密钥轮换演练通过
- 监控告警可触发并闭环处理

## 4. 角色分工建议
- 产品/方案：确认流程、状态机、错误码
- 前端（桌面端）：Tauri + React 页面与权限 UI
- 后端：API、事务一致性、审计
- 安全：密钥管理、2FA、风控规则
- QA：流程测试、异常测试、性能测试

## 5. 测试计划
1. 功能测试
- 人工绑定全链路
- 自动投票凭证签发全链路
- 解绑/冻结等异常流程

2. 安全测试
- 鉴权绕过
- 重放攻击
- 越权操作
- 暴力请求与限流

3. 性能测试
- 凭证签发 P95
- 并发申请峰值
- 数据库慢查询压测

## 6. 发布与回滚
- 发布策略：先灰度后全量
- 回滚策略：
  - API 回滚到上一个稳定版本
  - 数据库使用向前兼容迁移，不做破坏性降级
  - signer 支持双 key 窗口

## 7. 上线检查清单
- [ ] API 与 DB 字段与文档一致
- [ ] 审计日志完整可查
- [ ] 唯一约束与事务一致性验证通过
- [ ] 2FA 与 RBAC 生效
- [ ] 备份恢复演练通过
- [ ] 灰度验证通过后再全量发布

